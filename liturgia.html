<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Liturgia Diária - Rosarium</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <button class="btn-back" onclick="goBack()">← Voltar</button>
      <div class="header-title">
        <div class="header-logo">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
        </div>
        <span>Liturgia Diária</span>
      </div>
    </div>
  </header>

  <!-- Conteúdo -->
  <div class="page-container">
    <div class="page-content container-md">
      <h1 class="page-title">Liturgia Diária</h1>

      <!-- Seletor de Data -->
      <div class="card" style="margin-bottom: 2rem;">
        <div class="form-group">
          <label class="label">Selecione a data:</label>
          <input type="date" id="date-input" class="input" onchange="loadLiturgia()">
        </div>
        <button class="btn" onclick="loadLiturgia()" style="width: 100%;">Carregar Liturgia</button>
      </div>

      <!-- Conteúdo da Liturgia -->
      <div id="liturgia-container">
        <!-- Gerado por JavaScript -->
      </div>

      <!-- Botão Lectio Divina -->
      <div id="lectio-button-container" style="text-align: center; margin-top: 2rem; display: none;">
        <button class="btn btn-secondary" onclick="startLectio()">Iniciar Lectio Divina</button>
      </div>

      <!-- Lectio Divina (oculto inicialmente) -->
      <div id="lectio-container" class="hidden">
        <h2 class="page-title" style="margin-top: 2rem;">Lectio Divina</h2>
        
        <!-- Abas de Etapas -->
        <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
          <button class="btn" onclick="selectLectioStep(1)" id="step-1-btn">1. Leitura</button>
          <button class="btn btn-outline" onclick="selectLectioStep(2)" id="step-2-btn">2. Meditação</button>
          <button class="btn btn-outline" onclick="selectLectioStep(3)" id="step-3-btn">3. Oração</button>
          <button class="btn btn-outline" onclick="selectLectioStep(4)" id="step-4-btn">4. Contemplação</button>
        </div>

        <!-- Conteúdo das Etapas -->
        <div class="card">
          <h3 class="card-title" id="step-title">1. Leitura</h3>
          <div class="card-content" id="step-content">
            <p>Leia atentamente a passagem bíblica da Liturgia Diária.</p>
          </div>
          
          <div class="form-group">
            <label class="label">Suas anotações:</label>
            <textarea class="input" id="step-notes" placeholder="Escreva suas reflexões..."></textarea>
          </div>
          
          <div style="display: flex; gap: 1rem;">
            <button class="btn" onclick="saveLectioStep()">Salvar</button>
            <button class="btn btn-outline" onclick="closeLectio()">Fechar</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
  <script>
    let currentLectioStep = 1;
    let liturgiaData = null;

    function initDate() {
      const today = new Date();
      const dateStr = today.toISOString().split('T')[0];
      document.getElementById('date-input').value = dateStr;
      loadLiturgia();
    }

    async function loadLiturgia() {
      const dateInput = document.getElementById('date-input').value;
      if (!dateInput) return;
      
      const [year, month, day] = dateInput.split('-');
      const container = document.getElementById('liturgia-container');
      container.innerHTML = '<p style="text-align: center;">Carregando liturgia...</p>';
      
      try {
        const data = await getLiturgia(day, month, year);
        liturgiaData = data;
        
        container.innerHTML = `
          <div class="card">
            <h3 class="card-title">${data.titulo || 'Liturgia do Dia'}</h3>
            <div class="card-content">
              <h4 style="margin-top: 1rem; margin-bottom: 0.5rem; font-weight: 600;">Leituras:</h4>
              <p>${data.leituras || 'Não disponível'}</p>
              
              ${data.evangelho ? `
                <h4 style="margin-top: 1rem; margin-bottom: 0.5rem; font-weight: 600;">Evangelho:</h4>
                <p>${data.evangelho}</p>
              ` : ''}
            </div>
          </div>
        `;
        
        document.getElementById('lectio-button-container').style.display = 'block';
      } catch (error) {
        container.innerHTML = '<p style="color: var(--destructive);">Erro ao carregar liturgia. Verifique sua conexão.</p>';
      }
    }

    function startLectio() {
      document.getElementById('liturgia-container').style.display = 'none';
      document.getElementById('lectio-button-container').style.display = 'none';
      document.getElementById('lectio-container').classList.remove('hidden');
      selectLectioStep(1);
    }

    function selectLectioStep(step) {
      currentLectioStep = step;
      
      // Atualizar botões
      for (let i = 1; i <= 4; i++) {
        const btn = document.getElementById(`step-${i}-btn`);
        if (i === step) {
          btn.classList.remove('btn-outline');
        } else {
          btn.classList.add('btn-outline');
        }
      }
      
      // Atualizar conteúdo
      const titles = [
        '1. Leitura',
        '2. Meditação',
        '3. Oração',
        '4. Contemplação'
      ];
      
      const contents = [
        'Leia atentamente a passagem bíblica da Liturgia Diária. Deixe a Palavra de Deus falar ao seu coração.',
        'Medite sobre o que você leu. O que Deus quer dizer para você através dessa passagem?',
        'Ore respondendo ao que Deus lhe disse. Converse com Deus sobre seus sentimentos e compreensão.',
        'Contemple a presença de Deus. Descanse em silêncio na presença do Senhor.'
      ];
      
      document.getElementById('step-title').textContent = titles[step - 1];
      document.getElementById('step-content').innerHTML = `<p>${contents[step - 1]}</p>`;
      
      // Carregar notas salvas
      const saved = Storage.get(`lectio_step_${step}`, '');
      document.getElementById('step-notes').value = saved;
    }

    function saveLectioStep() {
      const notes = document.getElementById('step-notes').value;
      Storage.set(`lectio_step_${currentLectioStep}`, notes);
      alert('Anotações salvas com sucesso!');
    }

    function closeLectio() {
      document.getElementById('lectio-container').classList.add('hidden');
      document.getElementById('liturgia-container').style.display = 'block';
      document.getElementById('lectio-button-container').style.display = 'block';
    }

    // Inicializar
    document.addEventListener('DOMContentLoaded', initDate);
  </script>
</body>
</html>
