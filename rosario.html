<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Rosário Completo - Rosarium</title>
<link rel="stylesheet" href="style.css">
<style>
  :root{--primary:#4360C6;--bg:#FCFAFB;--text:#121212;--muted:#666;--icon:#4D3E43}
  body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text)}
  .header{display:flex;align-items:center;padding:12px 16px}
  .btn-back{background:transparent;border:none;cursor:pointer;color:var(--text)}
  .wrap{max-width:760px;margin:1.2rem auto;padding:0 16px}
  .card{background:#fff;border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(0,0,0,.04);margin-bottom:12px}
  .prayer{padding:12px}
  .prayer h3{margin:0 0 .5rem}
  .meta{color:var(--muted);margin-top:.6rem}
  .misterio{background:#eef6ff;border-left:4px solid var(--primary);padding:10px;border-radius:8px;margin-bottom:12px}
  .beads{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin:12px 0}
  .bead{display:inline-flex;align-items:center;justify-content:center;user-select:none;cursor:pointer;background:#fbfbfb;color:var(--icon);box-shadow:0 1px 3px rgba(0,0,0,.04)}
  .bead.am{width:36px;height:36px;border-radius:50%;font-weight:600}
  .bead.pn{width:46px;height:46px;border-radius:50%;font-weight:700}
  .bead.filled{background:var(--primary);color:#fff}
  .controls{display:flex;gap:.6rem;justify-content:center;margin-top:10px;flex-wrap:wrap}
  .btn{padding:10px 14px;border-radius:10px;border:none;background:var(--primary);color:#fff;cursor:pointer;font-weight:700}
  .btn-outline{background:transparent;border:1px solid #ddd;color:var(--text);padding:10px 14px;border-radius:10px}
  @media (max-width:420px){ .bead.am{width:30px;height:30px} .bead.pn{width:40px;height:40px} }
</style>
</head>
<body>
  <header class="header">
    <button class="btn-back" onclick="history.back()">← Voltar</button>
    <div style="font-weight:700;margin-left:8px">Rosário Completo</div>
  </header>

  <main class="wrap">
    <!-- mostra dezena atual: título do mistério + virtude -->
    <section id="misterioCard" class="card misterio" aria-hidden="true">
      <strong id="mTitle">Mistério</strong>
      <div id="mDesc"></div>
      <div class="meta" id="mVirtude"></div>
    </section>

    <!-- oração grande -->
    <section class="card prayer" id="prayerCard" aria-live="polite">
      <h3 id="pTitle">Oração atual</h3>
      <p id="pText">Carregando...</p>
      <div class="meta" id="pMeta"></div>
    </section>

    <!-- beads: mostra apenas 10 beads + 1 PN bead (pai-nosso da dezena) -->
    <section class="card">
      <div style="display:flex;justify-content:center;margin-bottom:12px">
        <div id="credoCross" style="width:44px;height:44px;display:inline-flex;align-items:center;justify-content:center;border-radius:6px;background:#fff;color:var(--icon);box-shadow:0 1px 3px rgba(0,0,0,.04);cursor:pointer">✝</div>
      </div>

      <div id="beads" class="beads" aria-hidden="false"></div>

      <div style="text-align:center;margin-top:8px" id="progressText"></div>

      <div class="controls">
        <button id="prevDec" class="btn-outline" aria-label="Dezena anterior">Dezena anterior</button>
        <button id="nextBtn" class="btn" aria-label="Próxima oração">Próxima oração</button>
        <button id="nextDec" class="btn-outline" aria-label="Próxima dezena">Próxima dezena</button>
        <button id="resetRos" class="btn-outline" aria-label="Resetar Rosário">Resetar Rosário</button>
      </div>
    </section>
  </main>

<script>
/* Rosário completo — interface por dezena (mostra uma dezena por vez)
   - 20 dezenas (4 coroas x 5)
   - cada dezena: PN (pai), 10 AM (ave), Glória, jaculatória "Ó meu Jesus..."
   - Mistérios e virtudes por dia; a virtude aparece no topo da dezena
   - Salve Rainha ao final
   - Armazenamento por dezena e posição dentro da dezena
*/

const ORA = {
  credo: 'Creio em Deus Pai todo-poderoso... Amém.',
  pai: 'Pai nosso, que estais nos céus... Amém.',
  ave: 'Ave Maria, cheia de graça... Amém.',
  gloria: 'Glória ao Pai, e ao Filho, e ao Espírito Santo. Amém.',
  jac: 'Ó meu Jesus, perdoai-nos, livrai-nos do fogo do inferno, levai as almas todas ao céu, especialmente as que mais precisarem da vossa misericórdia. Amém.',
  salve: 'Salve Rainha, Mãe de Misericórdia... Amém.'
};

const MISTERIOS = {
  gozosos:[
    {titulo:'Anunciação', desc:'O Anjo anuncia a Maria que será Mãe de Deus.', virtude:'Humildade'},
    {titulo:'Visitação', desc:'Maria visita Isabel.', virtude:'Caridade'},
    {titulo:'Nascimento', desc:'Jesus nasce em Belém.', virtude:'Pobreza'},
    {titulo:'Apresentação', desc:'Jesus é apresentado no Templo.', virtude:'Obediência'},
    {titulo:'Encontro no Templo', desc:'Jesus entre os doutores.', virtude:'Devoção'}
  ],
  luminosos:[
    {titulo:'Batismo no Jordão', desc:'Jesus é batizado por João.', virtude:'Abertura ao Espírito'},
    {titulo:'Bodas de Caná', desc:'Jesus transforma água em vinho.', virtude:'Fé'},
    {titulo:'Anúncio do Reino', desc:'Jesus proclama a chegada do Reino.', virtude:'Conversão'},
    {titulo:'Transfiguração', desc:'Jesus é transfigurado.', virtude:'Desejo de Deus'},
    {titulo:'Eucaristia', desc:'Instituição da Eucaristia.', virtude:'Adoração'}
  ],
  dolorosos:[
    {titulo:'Agonia no Horto', desc:'Jesus reza no Horto das Oliveiras.', virtude:'Contrição'},
    {titulo:'Flagelação', desc:'Jesus é flagelado.', virtude:'Pureza'},
    {titulo:'Coroação de Espinhos', desc:'Jesus é coroado de espinhos.', virtude:'Paciência'},
    {titulo:'Caminho do Calvário', desc:'Jesus carrega a Cruz.', virtude:'Perseverança'},
    {titulo:'Crucifixão', desc:'Jesus morre na Cruz.', virtude:'Sacrifício'}
  ],
  gloriosos:[
    {titulo:'Ressurreição', desc:'Jesus ressuscita.', virtude:'Fé'},
    {titulo:'Ascensão', desc:'Jesus sobe aos céus.', virtude:'Esperança'},
    {titulo:'Pentecostes', desc:'Descida do Espírito Santo.', virtude:'Amor do Espírito Santo'},
    {titulo:'Assunção', desc:'Maria é assunta aos céus.', virtude:'Devoção'},
    {titulo:'Coroação', desc:'Maria é coroada Rainha.', virtude:'Confiança'}
  ]
};

const COROAS = ['gozosos','luminosos','dolorosos','gloriosos']; // ordem
const STORAGE = 'rosarium_rosario_v1';
let state = { coronaIdx: 0, dezenaIdx: 0, step: -1 }; // step: -1 = show Credo/opening, 0=PN,1..10=AM,11=Gloria,12=Jac

function load(){ try{ const raw = localStorage.getItem(STORAGE); if(raw) state = JSON.parse(raw);}catch(e){console.warn(e)} }
function save(){ try{ localStorage.setItem(STORAGE, JSON.stringify(state)); }catch(e){console.warn(e)} }

function coronaByDay(){
  const d = new Date().getDay();
  if(d===1||d===6) return 0; // seg/sáb -> gozosos
  if(d===2||d===5) return 2; // ter/sex -> dolorosos
  if(d===4) return 1; // quinta -> luminosos
  return 3; // dom/qua -> gloriosos
}

function currentMystery(){
  const corona = COROAS[state.coronaIdx];
  return MISTERIOS[corona][state.dezenaIdx];
}

function render(){
  const mCard = document.getElementById('misterioCard');
  const mTitle = document.getElementById('mTitle');
  const mDesc  = document.getElementById('mDesc');
  const mVirt  = document.getElementById('mVirtude');
  const pTitle = document.getElementById('pTitle');
  const pText  = document.getElementById('pText');
  const pMeta  = document.getElementById('pMeta');
  const beads  = document.getElementById('beads');

  const myst = currentMystery();
  mTitle.innerText = `${myst.titulo} — Dezena ${state.dezenaIdx + 1} (${COROAS[state.coronaIdx]})`;
  mDesc.innerText = myst.desc;
  mVirt.innerText = `Virtude: ${myst.virtude}`;
  mCard.style.display = 'block';

  // opening (initial prayers) if step == -1: show Credo and initial opening; we start at -1 so user can see Credo
  if(state.step === -1){
    pTitle.innerText = 'Creio';
    pText.innerText = ORA.credo;
    pMeta.innerText = 'Abertura — depois avance para continuar';
    // beads show simple opening visual
    beads.innerHTML = '';
    const pnDiv = document.createElement('div'); pnDiv.className='bead pn'; pnDiv.textContent='P'; pnDiv.classList.add('filled'); beads.appendChild(pnDiv);
    for(let i=1;i<=3;i++){ const a=document.createElement('div'); a.className='bead am'; a.textContent=''; if(i<=0) a.classList.add('filled'); beads.appendChild(a); }
    document.getElementById('progressText').innerText = 'Abertura';
    return;
  }

  // render based on step inside dezena
  if(state.step === 0){
    pTitle.innerText = 'Pai-Nosso (da dezena)';
    pText.innerText = ORA.pai;
    pMeta.innerText = `Dezena ${state.dezenaIdx+1} de 5 - Coroa: ${COROAS[state.coronaIdx]}`;
  } else if(state.step >=1 && state.step <=10){
    pTitle.innerText = `Ave-Maria (${state.step} de 10)`;
    pText.innerText = ORA.ave;
    pMeta.innerText = `Dezena ${state.dezenaIdx+1} de 5 - Coroa: ${COROAS[state.coronaIdx]}`;
  } else if(state.step === 11){
    pTitle.innerText = 'Glória ao Pai';
    pText.innerText = ORA.gloria;
    pMeta.innerText = '';
  } else if(state.step === 12){
    pTitle.innerText = 'Jaculatória';
    pText.innerText = ORA.jac;
    pMeta.innerText = 'Depois dessa, avance para a próxima dezena';
  }

  // beads: PN + 10 AM
  beads.innerHTML = '';
  const pnDiv = document.createElement('div');
  pnDiv.className = 'bead pn' + (state.step >= 0 ? ' filled' : '');
  pnDiv.textContent = 'P';
  pnDiv.onclick = ()=> jumpToStep(0);
  beads.appendChild(pnDiv);
  for(let i=1;i<=10;i++){
    const amDiv = document.createElement('div');
    amDiv.className = 'bead am' + (state.step >= i ? ' filled' : '');
    amDiv.title = `Ave-Maria ${i}`;
    amDiv.onclick = ()=> jumpToStep(i);
    beads.appendChild(amDiv);
  }

  document.getElementById('progressText').innerText = `Coroa: ${COROAS[state.coronaIdx]} — Dezena ${state.dezenaIdx+1} / 5`;
}

// jump within current dezena to step 0..12
function jumpToStep(s){
  if(s < 0 || s > 12) return;
  state.step = s;
  save(); render();
}

function next(){
  // if opening (-1) -> move to PN (0)
  if(state.step === -1){ state.step = 0; save(); render(); return; }
  if(state.step >=0 && state.step < 12){
    state.step++;
    save(); render(); return;
  }
  // if at 12 and user clicks next -> go to next dezena automatically
  if(state.step === 12){
    advanceDezena(1);
  }
}

function prevDezena(){ advanceDezena(-1); }
function nextDezena(){ advanceDezena(1); }

function advanceDezena(delta){
  let newDez = state.dezenaIdx + delta;
  let newCorona = state.coronaIdx;
  if(newDez < 0){
    newCorona = Math.max(0, state.coronaIdx - 1);
    newDez = 4;
  } else if(newDez > 4){
    newCorona = Math.min(COROAS.length - 1, state.coronaIdx + 1);
    newDez = 0;
  }
  // if we've gone past the last corona/dezena (finished rosary), keep at last and show Salve (handled separately if you want)
  state.coronaIdx = newCorona;
  state.dezenaIdx = newDez;
  state.step = 0; // start at PN
  save(); render();
}

// RESET function for the Rosary (user requested)
function resetRosario(){
  if(!confirm('Deseja realmente resetar o Rosário? Isso levará ao início (Credo).')) return;
  // reset to initial opening; corona default by day
  state = { coronaIdx: coronaByDay(), dezenaIdx: 0, step: -1 };
  save(); render();
}

document.addEventListener('DOMContentLoaded', ()=>{
  load();
  // normalize state if malformed
  if(typeof state.coronaIdx !== 'number' || typeof state.dezenaIdx !== 'number' || typeof state.step !== 'number'){
    state = { coronaIdx: coronaByDay(), dezenaIdx: 0, step: -1 };
  }
  document.getElementById('nextBtn').addEventListener('click', next);
  document.getElementById('prevDec').addEventListener('click', prevDezena);
  document.getElementById('nextDec').addEventListener('click', nextDezena);
  document.getElementById('credoCross').addEventListener('click', ()=>{ state.step = -1; save(); render(); });
  document.getElementById('resetRos').addEventListener('click', resetRosario);
  render();
});
</script>
</body>
</html>
